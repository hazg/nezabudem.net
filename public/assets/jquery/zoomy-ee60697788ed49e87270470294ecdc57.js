/*
* Zoomy 1.3.3 - jQuery plugin
* http://redeyeops.com/plugins/zoomy
*
* Copyright (c) 2010 Jacob Lowe (http://redeyeoperations.com)
* Dual licensed under the MIT (MIT-LICENSE.txt)
* and GPL (GPL-LICENSE.txt) licenses.
*
* Built for jQuery library
* http://jquery.com
*
* Addition fixes and modifications done by Larry Battle ( blarry@bateru.com )
* Code has been refactored and the logic has been corrected.
*
*/
(function(e){"use strict";var t={count:[],pos:null};e.fn.zoomy=function(n,r){var i={zoomSize:200,round:!0,glare:!0,clickable:!1,attr:"href",border:"5px solid #999",zoomInit:null,zoomStart:null,zoomStop:null},s="click",o={move:function(e,n,i){var s=function(e,t){var n=e/t;return n},o=n.attr("rel"),u=e.offset(),a=t[o].zoom.border,f=t[o].zoom.x,l=t[o].zoom.y,c=t[o].css.width,h=t[o].css.height,p=r.zoomSize+a*2,d=p/2,v=s(c,f),m=s(h,l),g=d-d*v-a*v+a,y=function(e){var t=e-p-a+g;return t},b=y(c),w=y(h),E=l-p,S=f-p,x=function(e,t){var n=e-t-d;return n},T=function(e,t,n){var r=(e-t)/n-d+a;return r},N=function(e,t,n,r){var i="-"+e+"px "+"-"+t+"px",s={backgroundPosition:i,left:n,top:r};return s},C=x(i.pageX,u.left),k=x(i.pageY,u.top),L=T(i.pageX,u.left,v),A=T(i.pageY,u.top,m),O={0:[L,A,C,k],1:[0,A,-g,k],2:[0,0,-g,-g],3:[0,E,-g,w],4:[L,0,C,-g],5:[S,0,b,-g],6:[S,A,b,k],7:[S,E,b,w],8:[L,E,C,w]},M=-g<=C,_=-g>C,D=-g<=k,P=-g>k,H=w>k,B=w<=k,j=b>C,F=b<=C,I=M&&D&&j&&H?0:_?D&&H?1:P?2:B?3:null:P?j?4:5:F?H?6:7:B?8:null,q=N(O[I][0],O[I][1],O[I][2],O[I][3],O[I][4],O[I][5]);n.css(q||{})},classes:function(e){var n=e.find(".zoomy").attr("rel");t[n].state===0||t[n].state===null?e.removeClass("inactive"):e.addClass("inactive")},enter:function(e,n){var r=n.attr("rel");t[r].state=1,n.css("visibility","visible"),o.classes(e)},leave:function(e,n,r){var i=n.attr("rel");r!==null?t[i].state=null:t[i].state=0,n.css("visibility","hidden"),o.classes(e)},callback:function(n,r){var i=n,s=r.attr("rel");i!==null&&typeof i=="function"&&i(e.extend({},t[s],t.pos))}},u={round:function(e,t){var n=r.round?e===undefined?r.zoomSize+t/2+"px":r.zoomSize/2+"px "+r.zoomSize/2+"px 0px 0px":0;return n},glare:function(t){t.children("span").css({height:r.zoomSize/2,width:r.zoomSize-10,margin:e.browser.msie&&parseInt(e.browser.version,10)===9?0:"5px auto","border-radius":u.round(0)})},border:function(e){var t=r.border.replace(/^\s*|\s*$/g,""),n=t.split(" "),i=parseFloat(n[0]),s=n.length>2&&i*1===i?i:0;return[t,s]},params:function(n,i){var s=n.children("img"),o=u.border(i),a={marginTop:s.css("margin-top"),marginRight:s.css("margin-right"),marginBottom:s.css("margin-bottom"),marginLeft:s.css("margin-left")},f={"float":s.css("float")},l={display:"block",height:s.height(),width:s.width(),position:"relative"},c=function(){var e=n.parent("*:first").css("text-align");e==="center"&&(a.marginRight="auto",a.marginLeft="auto")},h=i.attr("rel"),p={};f["float"]==="none"&&c(),e.extend(p,a,f,l),t[h].css=p,r.glare||i.children("span").css({height:r.zoomSize-10,width:r.zoomSize-10}),i.css({width:r.width,height:r.height,"border-radius":u.round(undefined,o[1]),border:o[0]}),s.css("margin","0px"),s.one("load",function(){n.css(t[h].css)}).each(function(){(this.complete||e.browser.msie&&parseInt(e.browser.version,10)===6)&&e(this).trigger("load")})}},a={image:function(n,i){var s=i.attr("rel");i.show().css({top:"-999999px",left:"-999999px"}),i.find("img").attr("src")!==n&&i.find("img").attr("src",n).load(function(){var e=r.glare?"<span/>":"",o=u.border(i);n=n.replace(/ /g,"%20"),t[s].zoom={x:i.find("img").width(),y:i.find("img").height(),border:o[1]},i.append(e).css({"background-image":"url("+n+")"}).find("img").remove(),u.glare(i)}).each(function(){(this.complete||e.browser.msie&&parseInt(e.browser.version,10)===6)&&e(this).trigger("load")})},zoom:function(i,s){t[s]={state:null,index:s},t.count.push(0);var f=typeof i.attr(r.attr)=="string"&&r.attr!=="href"?i.attr(r.attr):i.attr("href"),l=null,c=r.zoomInit,h=function(){var e=[],u=function(e){o.move(i,l,e)},a=function(){o.enter(i,l),i.bind("mousemove",u),o.callback(r.zoomStart,l)},f=function(e){o.leave(i,l,e),i.unbind("mousemove",u),o.callback(r.zoomStop,l)},c={event:function(e){t.pos=e,r.clickable||e.preventDefault(),t[s].state===0||t[s].state===null?(a(),o.move(i,l,e)):t[s].state===1&&n!=="mouseover"&&n!=="mouseenter"&&f(0)},mouseover:function(e){t.pos=e,t[s].state===0&&a()},mouseleave:function(e){t.pos=e,t[s].state===1&&f(null)},click:function(){return!1}};n==="mouseover"?e[n]=c.event:(e[n]=c.event,e.mouseover=c.mouseover),!r.clickable&&n!=="click"&&(e.click=c.click),e.mouseleave=c.mouseleave,i.bind(e)};h(),i.addClass("parent-zoom").append('<div class="zoomy zoom-obj-'+s+'" rel="'+s+'"><img id="tmp"/></div>'),l=e(".zoom-obj-"+s),c!==null&&typeof c=="function"&&c(i),u.params(i,l),a.image(f,l)},init:function(n,r){r.one("load",function(){a.zoom(n,t.count.length)}).each(function(){(this.complete||e.browser.msie&&parseInt(e.browser.version,10)===6)&&e(this).trigger("load")})}};typeof n=="object"&&r===undefined?(r=n,n=s):n===undefined&&(n=s),r=e.extend(i,r),e(this).each(function(){var t=e(this),n=t.find("img");a.init(t,n)})}})(jQuery);